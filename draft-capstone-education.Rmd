---
title: "Capstone Project"
author: "Education Policy"
date: "DPSS - Summer 2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE)
```

## Introduction

This is the **Education Policy** capstone project. On it, we will try to estimate the impact of a public policy designed and introduced by the City of Chicago, named [Safe Passage Program](https://www.cps.edu/services-and-supports/student-safety-and-security/safe-passage-program/). The main idea behind the program is *"to provide a positive, trusted adult presence for students as they travel to and from school."*

This project was designed for you to use the programming skills and causal inference techniques learned during DPSS. Thus, we expect you to put everything you've learned together and, with the assistance of Prof. Austin the DPSS's TAs, leverage your Data Analytics and Programming mastery.

For this Capstone we will provide you the 'schools-vs-crime.csv' file, a dataset that contains three variables:
  1. CRIME_ID: the unique identifier (ID) of a crime
  2. SCHOOLID: the unique identifier (ID) of the school
  3. distance: the linear distance (in yards) between a school and a crime scene.

## Question 1

Familiarize yourself with the City of Chicago [Safe Passage Program](https://www.cps.edu/services-and-supports/student-safety-and-security/safe-passage-program/). 

Get the data (download or access it through its API) concerning the [Chicago Public Schools Safe Passages Routes](https://www.cps.edu/services-and-supports/student-safety-and-security/safe-passage-program/).

a) Create a dataset with the schools that joined the safe route passages in the 2015-2016 school year (SY) and that have never joined the program before that (that means, since 2013 SY, the school first time apperance in the dataset was in 2015-2016 SY). Also, these schools must have remained in the program until 2017-2018 SY.

b) Create a second dataset with the schools that have never participated in the program from 2013-2014 SY to 2017-2018 SY.

c) Indicate how many schools you find for each group and which do you believe to be the treated and control group.

```{r}
## pacakges
if (!require("pacman")) install.packages("pacman")
pacman::p_load(tidyverse, lubridate, scales)

## (a) + (b)
url_schools <- 'https://raw.githubusercontent.com/ArthurCheib/dpss-capstone/main/df_schools.csv'

df_schools <- read.csv(url_schools, header = T, check.names = F) %>% 
  as_tibble()

head(df_schools, n = 5)

## (c)
df_schools %>% 
  count(safe_passage)
```


## Question 2

Now, get the 'Attendance Over Time' data (this one you will have to download it) concerning the [Chicago Public Schools Attendance metrics](https://www.cps.edu/about/district-data/metrics/).

a) Filter this dataset so that it only contains row cells with 'All (excludes Pre-K)' for the 'Group' column and year information for the years between 2013 and 2018 (both included).

b) Now, filter this dataset, so it only contains attendance information for control and treated schools you discovered in q1.

c) Produce one graph and one table containing some basic exploration of this dataset. Briefly describe what you have found (one short paragraph is enough).

```{r}
## (a)


```


## Question 3

Now, get the school location data (download or API) that is available in the [Chicago Data Portal](https://data.cityofchicago.org/). Try to figure out by yourself how to find such data in the portal (not a hard task).

a) Create a dataset that contains this variables:
- Schools' code
- Treatment indicator ('yes' or 'no')
- School's latitude
- School's longitude

b) Using the leaflet package, plot a map that has treated schools as red pins (markers) and control schools as blue pins.

c) Briefly describe what you see in your map. Anything interesting? (one short paragraph suffices)

## Question 4

Now, get the crime data for the years going from 2013 to 2018 (download or API) that is available in the [Chicago Data Portal](https://data.cityofchicago.org/). Try to figure out by yourself how to find such data in the portal (not a hard task).

a) After accessing it, merge this crime dataset with the dataset provided to you ('schools-vs-crime.csv') so that the provided dataset now contains the year column of each crime it contains.

b) Using the leaflet package, plot a map that has treated and control schools as red pins (markers) and each crime that took place within a 200 yards radius from it as blue circle markers

c) Produce one table containing some basic exploration of this dataset. Briefly describe what you have found (one short paragraph is enough).

d) Create a variable called 'total_crime' which is equal the amout of unique crime that took place
within 200 yards from a school.

```{r}
## (a)
url_crime <- 'https://raw.githubusercontent.com/ArthurCheib/dpss-capstone/main/crime-data.csv'

```


## Question 5

Finally, put together a dataset that contains, for each control and treated school:
- A school's unique identifier (ID)
- A year variable (that will have as rows values: 2013, 2014, 2015, 2016, 2017 and 2018)
- A variable indicating the year a school was treated (and NA in case it's a control school)
- A variable indicating 'yes' for every year a school was treated and 'no' for every year it was not
- The total number of crimes that took place within a 200-yards radius from the school for each year
- The attendance percentual of that school for each year

a) Run a fixed effects regression to see whether participating in the new policy is associated with less crime within a 200-yards from a school and with students outcome, in form of school attendance.
b) Interpret your results (coefficients)